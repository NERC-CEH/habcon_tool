# Habitat Connectivity tool

This is an R package written for the ERAMMP and EVAST projects which is used to measure the impact of planting on the connectivity of habitats. It relies heavily on the excellent _sf_ (https://r-spatial.github.io/sf/) and _terra_ (https://rspatial.github.io/terra/) packages. 

## Brief overview

In brief, this package buffers polygons from the _sf_ package and identifies areas where polygons overlap. This is in order to mimic that, for example, under agri-envrironment schemes planting might occur which (un/)intentionally connects two habitat parcels together; thus benefitting the species that are reliant on habitat patches. The functions also account for the dispersal abilities of the species/habitats of interest. For example, some birds are highly mobile, meaning that patches of suitable habitat may already be considered "connected" if they are within a certain distance of each other. Our function works by first identifying habitat patches that are already connected (as definied by a user-supplied distance) and then calculating the effect of planting/habitat managedment on these connected parcels.

## Disclaimer: Issues with measuring habitat connectivity

One of the issues with measuring habitat connectivity is scalability. When processing large spatial dataframes, you may end up with an extremely large computational load. Furthermore, it is difficult to split the job up and work on smaller subsets of the main data. If you cut the area down to a smaller square, you need to consider whether patches within your area of interest overlap with patches outside of your area. We address this in the `habitat_overlap` function (see below), in which you can supply two extents - an inner and an outer area. The difference between these two is the maximum distance that you expect connectivity to happen at. This should determined for each use case. 

This function **should** work at any scale, from local pacthes at fine resolution to (inter)national scale habitats. Some words of warning though. These have been designed for specific use cases and as such, we cannot ensure transferability to other uses.

## Disclaimer: As slow as a sloth 

Furthermore, the functions are almost certainly not well optimised and are, unfortunately, slow (due to time pressures and a rubbish package author yaddah yaddah). When we ran the code across a large spatial scale (entirity of Wales), we used a cluster computer to speed up processing. We would highly recommend **not** running a large spatial area on your own computer (although if you are running a coarse enough resolution it might work fine).

## Package structure

### Function `habitat_overlap`

The function in this package that does the heavy lifting is `habitat_overlap`. This identifies the parcels that overlap and returns a named list comprising five different spatial aggregations generated by the function. It does this using a series of spatial helper functions. While this function can be used by itself, to identify only overlapping habitats we access it through the `habitat_connect` wrapper function.

### Function `habitat_connect`

This is a wrapper function for the `habitat_overlap` function. It runs the `habitat_overlap` function and crops it to a central square for ease of joining different squares together.

